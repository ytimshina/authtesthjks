<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Employee Management System</title>
  <script src="https://alcdn.msauth.net/browser/2.37.0/js/msal-browser.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #000000;
      min-height: 100vh;
      padding: 20px;
      color: #ffffff;
      overflow-x: hidden;
    }

    .background-effects {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: -1;
      background: #000000;
    }

    .floating-orb {
      position: absolute;
      border-radius: 50%;
      background: linear-gradient(45deg, rgba(40,40,40,0.3), rgba(60,60,60,0.15));
      backdrop-filter: blur(20px);
      animation: float 20s infinite ease-in-out;
      border: 1px solid rgba(255,255,255,0.05);
    }

    .orb-1 {
      width: 200px;
      height: 200px;
      top: 10%;
      left: 80%;
      animation-delay: 0s;
    }

    .orb-2 {
      width: 150px;
      height: 150px;
      bottom: 20%;
      left: 10%;
      animation-delay: -7s;
    }

    .orb-3 {
      width: 100px;
      height: 100px;
      top: 60%;
      right: 15%;
      animation-delay: -14s;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0px) translateX(0px) rotate(0deg); }
      33% { transform: translateY(-30px) translateX(20px) rotate(120deg); }
      66% { transform: translateY(20px) translateX(-20px) rotate(240deg); }
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: rgba(20, 20, 20, 0.9);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 24px;
      padding: 40px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
      transition: all 0.3s ease;
    }

    .container:hover {
      transform: translateY(-5px);
      box-shadow: 0 16px 64px rgba(0, 0, 0, 0.7);
    }

    .header {
      text-align: center;
      margin-bottom: 40px;
      padding-bottom: 30px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    h1 {
      font-size: 3rem;
      font-weight: 700;
      color: #ffffff;
      margin-bottom: 10px;
      letter-spacing: -0.02em;
    }

    .subtitle {
      color: rgba(255, 255, 255, 0.7);
      font-size: 1.1rem;
      font-weight: 300;
    }

    .glass-card {
      background: rgba(30, 30, 30, 0.8);
      backdrop-filter: blur(15px);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 30px;
      transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      position: relative;
      overflow: hidden;
    }

    .glass-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.05), transparent);
      transition: left 0.5s;
    }

    .glass-card:hover::before {
      left: 100%;
    }

    .glass-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 48px rgba(0, 0, 0, 0.4);
      border-color: rgba(255, 255, 255, 0.15);
    }

    .section-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: white;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .section-icon {
      width: 24px;
      height: 24px;
      background: linear-gradient(135deg, #444444, #666666);
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 14px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: rgba(255, 255, 255, 0.9);
      font-size: 0.95rem;
    }

    .required {
      color: #ff6b6b;
      margin-left: 4px;
    }

    input, select, textarea {
      width: 100%;
      padding: 14px 18px;
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 12px;
      font-size: 16px;
      background: rgba(40, 40, 40, 0.8);
      color: white;
      backdrop-filter: blur(10px);
      transition: all 0.3s ease;
      font-family: inherit;
    }

    input::placeholder, textarea::placeholder {
      color: rgba(255, 255, 255, 0.4);
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #888888;
      background: rgba(50, 50, 50, 0.9);
      box-shadow: 0 0 0 3px rgba(136, 136, 136, 0.1);
      transform: translateY(-1px);
    }

    select option {
      background: #2a2a2a;
      color: white;
    }

    textarea {
      height: 100px;
      resize: vertical;
    }

    .button {
      background: linear-gradient(135deg, #444444, #666666);
      color: white;
      padding: 14px 28px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 500;
      transition: all 0.3s ease;
      margin-right: 15px;
      position: relative;
      overflow: hidden;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(68, 68, 68, 0.4);
      background: linear-gradient(135deg, #555555, #777777);
    }

    .button:active {
      transform: translateY(0);
    }

    .button:disabled {
      background: rgba(60, 60, 60, 0.5);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .button-secondary {
      background: rgba(40, 40, 40, 0.8);
      border: 1px solid rgba(255, 255, 255, 0.15);
    }

    .button-secondary:hover {
      background: rgba(50, 50, 50, 0.9);
      box-shadow: 0 8px 25px rgba(40, 40, 40, 0.3);
    }

    .navigation-tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 30px;
      background: rgba(20, 20, 20, 0.8);
      padding: 8px;
      border-radius: 16px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.05);
    }

    .nav-tab {
      flex: 1;
      padding: 12px 20px;
      background: transparent;
      border: none;
      border-radius: 12px;
      color: rgba(255, 255, 255, 0.6);
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
    }

    .nav-tab.active {
      background: rgba(60, 60, 60, 0.8);
      color: white;
      backdrop-filter: blur(15px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .nav-tab:hover:not(.active) {
      background: rgba(40, 40, 40, 0.6);
      color: rgba(255, 255, 255, 0.8);
    }

    .form-section {
      display: none;
      animation: fadeInUp 0.5s ease-out;
    }

    .form-section.active {
      display: block;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .checkbox-group {
      display: flex;
      flex-direction: column;
      gap: 12px;
      background: rgba(20, 20, 20, 0.6);
      padding: 16px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.08);
    }

    .checkbox-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 8px;
      border-radius: 8px;
      transition: background 0.2s ease;
    }

    .checkbox-item:hover {
      background: rgba(40, 40, 40, 0.5);
    }

    .checkbox-item input[type="checkbox"] {
      width: 20px;
      height: 20px;
      accent-color: #666666;
    }

    .checkbox-item label {
      margin: 0;
      font-weight: 400;
    }

    .loading {
      color: rgba(255, 255, 255, 0.6);
      font-style: italic;
      text-align: center;
      padding: 20px;
    }

    .message {
      padding: 16px 20px;
      border-radius: 12px;
      margin: 20px 0;
      backdrop-filter: blur(10px);
    }

    .error {
      background: rgba(220, 53, 69, 0.15);
      border: 1px solid rgba(220, 53, 69, 0.3);
      color: #ff6b6b;
    }

    .success {
      background: rgba(40, 167, 69, 0.15);
      border: 1px solid rgba(40, 167, 69, 0.3);
      color: #51cf66;
    }

    .confirmation {
      background: rgba(40, 167, 69, 0.15);
      border: 1px solid rgba(40, 167, 69, 0.2);
      border-radius: 16px;
      padding: 30px;
      text-align: center;
      backdrop-filter: blur(15px);
    }

    .confirmation h2 {
      color: #51cf66;
      margin-bottom: 15px;
      font-size: 1.8rem;
    }

    .confirmation p {
      color: rgba(255, 255, 255, 0.8);
      line-height: 1.6;
      margin-bottom: 15px;
    }

    .hidden-field {
      display: none !important;
    }

    small {
      color: rgba(255, 255, 255, 0.6);
      font-size: 0.9rem;
      display: block;
      margin-top: 8px;
      line-height: 1.4;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .container {
        padding: 20px;
        margin: 10px;
      }
      
      h1 {
        font-size: 2rem;
      }
      
      .form-grid {
        grid-template-columns: 1fr;
      }
      
      .navigation-tabs {
        flex-direction: column;
      }
    }

    /* Loading Animation */
    .spinner {
      border: 3px solid rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      border-top: 3px solid #888888;
      width: 24px;
      height: 24px;
      animation: spin 1s linear infinite;
      display: inline-block;
      margin-right: 10px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="background-effects">
    <div class="floating-orb orb-1"></div>
    <div class="floating-orb orb-2"></div>
    <div class="floating-orb orb-3"></div>
  </div>

  <div class="container">
    <div class="header">
      <h1>Employee Management</h1>
      <p class="subtitle">Streamlined workforce management with automated ticket generation</p>
    </div>
    
    <!-- Login Section -->
    <div id="login-section" class="glass-card">
      <div class="section-title">
        <div class="section-icon">🔐</div>
        Authentication
      </div>
      <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
        <button class="button" onclick="signIn()">Sign In</button>
        <button class="button button-secondary" onclick="signOut()">Sign Out</button>
      </div>
      <div id="output" style="text-align: center; margin-top: 20px; color: rgba(255,255,255,0.8);"></div>
    </div>

    <!-- Main Navigation -->
    <div id="main-navigation" class="glass-card" style="display: none;">
      <div class="navigation-tabs">
        <button class="nav-tab active" onclick="showTab('employee-actions')">Employee Actions</button>
        <button class="nav-tab" onclick="showTab('update-employee')">Update Employee</button>
      </div>
    </div>

    <!-- Employee Actions Tab -->
    <div id="employee-actions-tab" class="form-section active">
      <!-- Vendor Selection -->
      <div id="form-type-section" class="glass-card" style="display: none;">
        <div class="section-title">
          <div class="section-icon">📋</div>
          Request Type
        </div>
        
        <div class="form-grid">
          <div class="form-group">
            <label for="isVendor">Is this account for a vendor? <span class="required">*</span></label>
            <select id="isVendor" required onchange="handleVendorSelection()">
              <option value="">Select an option</option>
              <option value="yes">Yes</option>
              <option value="no">No</option>
            </select>
          </div>

          <div class="form-group" id="formTypeGroup" style="display: none;">
            <label for="formType">Type of Form <span class="required">*</span></label>
            <select id="formType" required onchange="showSelectedForm()">
              <option value="">Select form type</option>
              <option value="new">New Employee</option>
              <option value="terminated">Terminated Employee</option>
              <option value="transfer">Internal Transfer</option>
            </select>
          </div>
        </div>
      </div>

      <!-- New Employee Form -->
      <div id="new-employee-form" class="glass-card form-section">
        <div class="section-title">
          <div class="section-icon">👤</div>
          New Employee Request
        </div>
        
        <form id="newEmployeeForm">
          <div class="section-title" style="font-size: 1.2rem; margin-top: 20px;">
            <div class="section-icon">ℹ️</div>
            Personal Information
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label for="newFirstName">First Name <span class="required">*</span></label>
              <input type="text" id="newFirstName" required>
            </div>

            <div class="form-group">
              <label for="newLastName">Last Name <span class="required">*</span></label>
              <input type="text" id="newLastName" required>
            </div>

            <div class="form-group">
              <label for="newPreferredName">Preferred Name</label>
              <input type="text" id="newPreferredName" placeholder="If different from first name">
            </div>

            <div class="form-group">
              <label for="newPhone">Mobile Phone <span class="required">*</span></label>
              <input type="tel" id="newPhone" placeholder="(xxx) xxx-xxxx" required>
              <small>Used only for account change notifications</small>
            </div>
          </div>

          <div class="section-title" style="font-size: 1.2rem; margin-top: 30px;">
            <div class="section-icon">🏢</div>
            Job Information
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label for="newJobTitle">Job Title <span class="required">*</span></label>
              <input type="text" id="newJobTitle" required>
            </div>

            <div class="form-group">
              <label for="newDepartment">Department <span class="required">*</span></label>
              <select id="newDepartment" required>
                <option value="">Select department</option>
                <option value="Engineering">Engineering</option>
                <option value="Manufacturing">Manufacturing</option>
                <option value="Quality">Quality</option>
                <option value="Sales">Sales</option>
                <option value="IT">IT</option>
                <option value="HR">HR</option>
                <option value="Finance">Finance</option>
              </select>
            </div>

            <div class="form-group">
              <label for="newManagerName">Manager's Name <span class="required">*</span></label>
              <input type="text" id="newManagerName" required readonly>
            </div>

            <div class="form-group">
              <label for="newWorkLocation">Work Location <span class="required">*</span></label>
              <select id="newWorkLocation" required>
                <option value="">Select location</option>
                <option value="Kansas City">Kansas City</option>
                <option value="Remote">Remote</option>
                <option value="Field">Field</option>
              </select>
            </div>

            <div class="form-group">
              <label for="newStartDate">Start Date <span class="required">*</span></label>
              <input type="date" id="newStartDate" required>
            </div>
          </div>

          <div class="section-title" style="font-size: 1.2rem; margin-top: 30px;">
            <div class="section-icon">🔧</div>
            System Access & Permissions
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label for="newModelEmployee">Model Employee Permissions <span class="required">*</span></label>
              <select id="newModelEmployee" required>
                <option value="">Loading employees...</option>
              </select>
              <small>New employee will receive similar permissions to this employee</small>
            </div>

            <div class="form-group">
              <label for="newRequireEmail">Requires Email? <span class="required">*</span></label>
              <select id="newRequireEmail" required>
                <option value="">Select an option</option>
                <option value="yes">Yes</option>
                <option value="no">No</option>
              </select>
            </div>

            <div class="form-group">
              <label for="newMSLicense">Microsoft License <span class="required">*</span></label>
              <select id="newMSLicense" required>
                <option value="">Select license type</option>
                <option value="E1">O365 E1 - Outlook Web & Teams</option>
                <option value="E3">O365 E3 - Full Office Suite</option>
              </select>
              <small>E3 has additional cost. Contact Business Technology for E5 license requests.</small>
            </div>

            <div class="form-group">
              <label for="newKineticAccess">Kinetic Access? <span class="required">*</span></label>
              <select id="newKineticAccess" required onchange="toggleKineticFields('new')">
                <option value="">Select an option</option>
                <option value="yes">Yes</option>
                <option value="no">No</option>
              </select>
            </div>

            <div class="form-group hidden-field" id="newKineticVersionGroup">
              <label for="newKineticVersion">Kinetic Version</label>
              <select id="newKineticVersion">
                <option value="">Select version</option>
                <option value="full">Full Kinetic</option>
                <option value="mes">MES</option>
                <option value="both">Both</option>
              </select>
              <small>Full version is workstation client. MES is for production activities.</small>
            </div>
          </div>

          <div class="section-title" style="font-size: 1.2rem; margin-top: 30px;">
            <div class="section-icon">📞</div>
            Communication & Phone
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label for="newTeamsPhone">Microsoft Teams Phone Licensing Option</label>
              <select id="newTeamsPhone">
                <option value="">Select an option</option>
                <option value="yes">Yes</option>
                <option value="no">No</option>
              </select>
              <small>Choose this option if the new hire's job responsibilities will include receiving inbound external calls. Additional cost applies.</small>
            </div>

            <div class="form-group">
              <label for="newDIDNumber">Direct Inbound Dialing (DID) Number Option</label>
              <select id="newDIDNumber">
                <option value="">Select an option</option>
                <option value="yes">Yes</option>
                <option value="no">No</option>
              </select>
              <small>Microsoft Teams Phone licensing allows inbound calls to be transferred from Front Desk. Outbound calls require a DID number.</small>
            </div>
          </div>

          <div class="section-title" style="font-size: 1.2rem; margin-top: 30px;">
            <div class="section-icon">⚙️</div>
            ECx Manager Access
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label for="newECxAccess">ECx Manager Access?</label>
              <select id="newECxAccess" onchange="toggleECxFields('new')">
                <option value="">Select an option</option>
                <option value="yes">Yes</option>
                <option value="no">No</option>
              </select>
              <small>ECx Manager is used for Engineering Change Management.</small>
            </div>
          </div>

          <div class="form-group hidden-field" id="newECxPermissionsGroup">
            <label>What can the Employee submit in ECx Manager?</label>
            <div class="checkbox-group">
              <div class="checkbox-item">
                <input type="checkbox" id="newECR" value="ECR">
                <label for="newECR">Engineering Change Requests (ECR)</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="newECO" value="ECO">
                <label for="newECO">Engineering Change Orders (ECO)</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="newECN" value="ECN">
                <label for="newECN">Engineering Change Notifications (ECN)</label>
              </div>
            </div>
          </div>

          <div class="section-title" style="font-size: 1.2rem; margin-top: 30px;">
            <div class="section-icon">📧</div>
            Distribution Lists & Notes
          </div>

          <div class="form-group">
            <label for="newModelDL">Distribution Lists Model <span class="required">*</span></label>
            <textarea id="newModelDL" required placeholder="Employee name to model distribution lists from"></textarea>
          </div>

          <div class="form-group">
            <label for="newSpecialNotes">Special Notes</label>
            <textarea id="newSpecialNotes" placeholder="Any special onboarding requirements or notes"></textarea>
          </div>

          <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-top: 30px;">
            <button type="submit" class="button">Submit New Employee Request</button>
            <button type="button" class="button button-secondary" onclick="resetAllForms()">Reset Form</button>
          </div>
        </form>
      </div>

      <!-- Terminated Employee Form -->
      <div id="terminated-employee-form" class="glass-card form-section">
        <div class="section-title">
          <div class="section-icon">❌</div>
          Employee Termination
        </div>
        
        <form id="terminatedEmployeeForm">
          <div class="section-title" style="font-size: 1.2rem; margin-top: 20px;">
            <div class="section-icon">👤</div>
            Employee Information
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label for="terminatedEmployeeSelect">Employee to Terminate <span class="required">*</span></label>
              <select id="terminatedEmployeeSelect" required>
                <option value="">Loading employees...</option>
              </select>
            </div>

            <div class="form-group">
              <label for="terminationDate">Termination Date <span class="required">*</span></label>
              <input type="date" id="terminationDate" required>
            </div>
          </div>

          <div class="section-title" style="font-size: 1.2rem; margin-top: 30px;">
            <div class="section-icon">📧</div>
            Email Account Management
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label for="terminatedHadEmail">Had Email Account? <span class="required">*</span></label>
              <select id="terminatedHadEmail" required onchange="toggleEmailForwarding()">
                <option value="">Select an option</option>
                <option value="yes">Yes</option>
                <option value="no">No</option>
              </select>
            </div>

            <div class="form-group hidden-field" id="terminatedEmailForwardingGroup">
              <label for="terminatedEmailForwarding">Forward Email To</label>
              <input type="text" id="terminatedEmailForwarding" placeholder="Employee name or leave blank">
            </div>

            <div class="form-group hidden-field" id="terminatedEmailAliasGroup">
              <label for="terminatedEmailAliasRemoval">Email Alias Removal Date</label>
              <input type="date" id="terminatedEmailAliasRemoval">
              <small>If the terminated employee has their email setup as a message alias, indicate when to remove it</small>
            </div>
          </div>

          <div class="section-title" style="font-size: 1.2rem; margin-top: 30px;">
            <div class="section-icon">💻</div>
            Device & Equipment
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label for="terminatedDeviceCollected">Device Collected? <span class="required">*</span></label>
              <select id="terminatedDeviceCollected" required onchange="toggleDeviceReason()">
                <option value="">Select an option</option>
                <option value="yes">Yes</option>
                <option value="no">No</option>
              </select>
            </div>

            <div class="form-group hidden-field" id="terminatedDeviceReasonGroup">
              <label for="terminatedDeviceReason">Why wasn't it collected? <span class="required">*</span></label>
              <input type="text" id="terminatedDeviceReason" placeholder="Explain why device was not collected">
            </div>
          </div>

          <div class="section-title" style="font-size: 1.2rem; margin-top: 30px;">
            <div class="section-icon">📞</div>
            Phone & Communication
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label for="terminatedPhoneTransfer">Company Phone Number Transfer? <span class="required">*</span></label>
              <select id="terminatedPhoneTransfer" required>
                <option value="">Select an option</option>
                <option value="yes">Yes - Transfer to new carrier</option>
                <option value="no">No</option>
              </select>
              <small>Phone stipends are automatically removed when the employee is removed from Paycor.</small>
            </div>
          </div>

          <div class="section-title" style="font-size: 1.2rem; margin-top: 30px;">
            <div class="section-icon">🔧</div>
            System Access Removal
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label for="terminatedKineticAccount">Disable Kinetic Account? <span class="required">*</span></label>
              <select id="terminatedKineticAccount" required>
                <option value="">Select an option</option>
                <option value="yes">Yes</option>
                <option value="no">No - No Kinetic Account</option>
              </select>
            </div>

            <div class="form-group">
              <label for="terminatedECxAccess">Remove ECx Manager Access?</label>
              <select id="terminatedECxAccess">
                <option value="">Select an option</option>
                <option value="yes">Yes</option>
                <option value="no">No - No ECx Access</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label for="terminatedSpecialNotes">Offboarding Notes</label>
            <textarea id="terminatedSpecialNotes" placeholder="Any special offboarding instructions or additional information"></textarea>
          </div>

          <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-top: 30px;">
            <button type="submit" class="button">Submit Termination Request</button>
            <button type="button" class="button button-secondary" onclick="resetAllForms()">Reset Form</button>
          </div>
        </form>
      </div>

      <!-- Transfer Form -->
      <div id="transfer-form" class="glass-card form-section">
        <div class="section-title">
          <div class="section-icon">🔄</div>
          Internal Transfer
        </div>
        
        <form id="transferForm">
          <div class="section-title" style="font-size: 1.2rem; margin-top: 20px;">
            <div class="section-icon">👤</div>
            Transfer Information
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label for="transferEmployeeSelect">Employee to Transfer <span class="required">*</span></label>
              <select id="transferEmployeeSelect" required>
                <option value="">Loading employees...</option>
              </select>
            </div>

            <div class="form-group">
              <label for="transferDate">Transfer Date <span class="required">*</span></label>
              <input type="date" id="transferDate" required>
            </div>

            <div class="form-group">
              <label for="transferWorkLocation">New Work Location <span class="required">*</span></label>
              <select id="transferWorkLocation" required>
                <option value="">Select location</option>
                <option value="Kansas City">Kansas City</option>
                <option value="Remote">Remote</option>
                <option value="Field">Field</option>
              </select>
            </div>

            <div class="form-group">
              <label for="transferModelEmployee">Model Employee <span class="required">*</span></label>
              <select id="transferModelEmployee" required>
                <option value="">Loading employees...</option>
              </select>
              <small>Employee will receive similar permissions to this employee</small>
            </div>
          </div>

          <div class="form-group">
            <label for="transferSpecialNotes">Transfer Notes</label>
            <textarea id="transferSpecialNotes" placeholder="Any special transfer requirements or changes needed"></textarea>
          </div>

          <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-top: 30px;">
            <button type="submit" class="button">Submit Transfer Request</button>
            <button type="button" class="button button-secondary" onclick="resetAllForms()">Reset Form</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Update Employee Tab -->
    <div id="update-employee-tab" class="form-section">
      <div class="glass-card">
        <div class="section-title">
          <div class="section-icon">✏️</div>
          Update Employee Information
        </div>
        
        <form id="updateEmployeeForm">
          <div class="form-group">
            <label for="updateEmployeeSelect">Select Employee <span class="required">*</span></label>
            <select id="updateEmployeeSelect" required onchange="loadEmployeeData()">
              <option value="">Loading employees...</option>
            </select>
          </div>

          <div class="section-title" style="font-size: 1.2rem; margin: 30px 0 20px 0;">
            <div class="section-icon">ℹ️</div>
            Personal Information
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label for="updateEmail">Email</label>
              <input type="email" id="updateEmail" placeholder="user@company.com">
            </div>

            <div class="form-group">
              <label for="updateDisplayName">Display Name</label>
              <input type="text" id="updateDisplayName" placeholder="John Doe">
            </div>

            <div class="form-group">
              <label for="updateMobilePhone">Mobile Phone</label>
              <input type="tel" id="updateMobilePhone" placeholder="(xxx) xxx-xxxx">
            </div>

            <div class="form-group">
              <label for="updateOfficePhone">Office Phone</label>
              <input type="tel" id="updateOfficePhone" placeholder="(xxx) xxx-xxxx">
            </div>
          </div>

          <div class="section-title" style="font-size: 1.2rem; margin: 30px 0 20px 0;">
            <div class="section-icon">🏢</div>
            Job Information
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label for="updateTitle">Job Title</label>
              <input type="text" id="updateTitle" placeholder="Job Title">
            </div>

            <div class="form-group">
              <label for="updateDepartment">Department</label>
              <input type="text" id="updateDepartment" placeholder="Department Name">
            </div>

            <div class="form-group">
              <label for="updateManager">Manager</label>
              <input type="text" id="updateManager" placeholder="Manager Display Name">
            </div>

            <div class="form-group">
              <label for="updateOffice">Office Location</label>
              <input type="text" id="updateOffice" placeholder="Office Location">
            </div>

            <div class="form-group">
              <label for="updateCompany">Company</label>
              <input type="text" id="updateCompany" placeholder="Company Name">
            </div>

            <div class="form-group">
              <label for="updateEmployeeID">Employee ID</label>
              <input type="text" id="updateEmployeeID" placeholder="Employee ID Number">
            </div>
          </div>

          <div class="section-title" style="font-size: 1.2rem; margin: 30px 0 20px 0;">
            <div class="section-icon">🔧</div>
            Technical Information
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label for="updateSamAccountName">SAM Account Name</label>
              <input type="text" id="updateSamAccountName" placeholder="jdoe">
            </div>

            <div class="form-group">
              <label for="updateUserPrincipalName">User Principal Name</label>
              <input type="text" id="updateUserPrincipalName" placeholder="jdoe@company.com">
            </div>

            <div class="form-group">
              <label for="updateEnabled">Account Status</label>
              <select id="updateEnabled">
                <option value="">Select status</option>
                <option value="true">Enabled</option>
                <option value="false">Disabled</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label for="updateNotes">Update Notes <span class="required">*</span></label>
            <textarea id="updateNotes" required placeholder="Describe the changes being made and reason for update"></textarea>
          </div>

          <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-top: 30px;">
            <button type="submit" class="button">Submit Update Request</button>
            <button type="button" class="button button-secondary" onclick="clearUpdateForm()">Clear Form</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Confirmation Section -->
    <div id="confirmation-section" class="glass-card" style="display: none;">
      <div class="confirmation">
        <h2>✓ Request Submitted Successfully</h2>
        <p><strong>Thank you!</strong> Your <span id="conf-form-type"></span> request has been submitted and a ticket has been automatically generated for tracking.</p>
        <div id="conf-details"></div>
        <p><strong>Submitted by:</strong> <span id="conf-manager"></span></p>
        <p>No further actions are needed at this time. The IT team will process this request and handle all necessary account changes and system access modifications.</p>
        <button class="button" onclick="submitAnother()">Submit Another Request</button>
      </div>
    </div>

    <!-- Vendor Redirect -->
    <div id="vendor-redirect" class="glass-card" style="display: none;">
      <div class="confirmation">
        <h2>Vendor Access Request</h2>
        <p>For vendor access requests, please use the dedicated vendor form:</p>
        <a href="https://forms.office.com/r/4de9ChLZX3" target="_blank" style="color: #4facfe; text-decoration: none; font-weight: bold;">
          Technical Needs - Vendor Access Request Form
        </a>
        <br><br>
        <button class="button" onclick="goBack()">Go Back</button>
      </div>
    </div>
  </div>

  <script>
    let msalInstance;
    let currentAccount;
    let allEmployees = [];

    window.addEventListener('DOMContentLoaded', () => {
      const msalConfig = {
        auth: {
          clientId: "8f3f4c99-7fc0-4dd7-8038-07a335b0d7ac",
          authority: "https://login.microsoftonline.com/36ac54bd-4aec-4920-8680-85a46915b905",
          redirectUri: "https://ytimshina.github.io/authtesthjks/"
        }
      };
      msalInstance = new msal.PublicClientApplication(msalConfig);
    });

    // Navigation Functions
    window.showTab = function(tabName) {
      // Update navigation
      document.querySelectorAll('.nav-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      event.target.classList.add('active');

      // Show/hide tab content
      document.querySelectorAll('#employee-actions-tab, #update-employee-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      document.getElementById(tabName + '-tab').classList.add('active');
    };

    // Authentication Functions
    window.signIn = async function () {
      try {
        const loginResponse = await msalInstance.loginPopup({
          scopes: ["user.read", "user.read.all", "directory.read.all"]
        });
        currentAccount = loginResponse.account;
        document.getElementById("output").innerHTML = `<div class="success">Welcome, ${currentAccount.username}</div>`;
        
        await loadAllEmployees();
        document.getElementById('main-navigation').style.display = 'block';
        document.getElementById('form-type-section').style.display = 'block';
        
      } catch (error) {
        console.error(error);
        document.getElementById("output").innerHTML = `<div class="error">Login failed: ${error.message}</div>`;
      }
    };

    window.signOut = async function () {
      try {
        if (currentAccount) {
          await msalInstance.logoutPopup({
            account: currentAccount
          });
        }
        currentAccount = null;
        document.getElementById("output").innerHTML = `<div class="success">Signed out successfully</div>`;
        
        document.getElementById('main-navigation').style.display = 'none';
        document.getElementById('form-type-section').style.display = 'none';
        hideAllForms();
        resetAllForms();
        
      } catch (error) {
        console.error('Sign out error:', error);
        document.getElementById("output").innerHTML = `<div class="error">Sign out failed: ${error.message}</div>`;
      }
    };

    // Employee Data Functions
    async function loadAllEmployees() {
      try {
        document.getElementById("output").innerHTML = '<div class="loading"><div class="spinner"></div>Loading employees...</div>';
        
        const tokenResponse = await msalInstance.acquireTokenSilent({
          scopes: ["user.read.all", "directory.read.all"],
          account: currentAccount
        });

        const [directReportsResponse, currentUserResponse] = await Promise.all([
          fetch('https://graph.microsoft.com/v1.0/me/directReports', {
            headers: {
              'Authorization': `Bearer ${tokenResponse.accessToken}`,
              'Content-Type': 'application/json'
            }
          }),
          fetch('https://graph.microsoft.com/v1.0/me', {
            headers: {
              'Authorization': `Bearer ${tokenResponse.accessToken}`,
              'Content-Type': 'application/json'
            }
          })
        ]);

        if (directReportsResponse.ok && currentUserResponse.ok) {
          const directReports = await directReportsResponse.json();
          const currentUser = await currentUserResponse.json();
          
          allEmployees = directReports.value;
          document.getElementById('newManagerName').value = currentUser.displayName;
          
          populateEmployeeDropdowns();
          document.getElementById("output").innerHTML = `<div class="success">Welcome, ${currentAccount.username}</div>`;
        }
        
      } catch (error) {
        console.error('Error loading employees:', error);
        document.getElementById('output').innerHTML = `<div class="error">Error loading employees: ${error.message}</div>`;
      }
    }

    function populateEmployeeDropdowns() {
      const selects = [
        'terminatedEmployeeSelect', 
        'transferEmployeeSelect', 
        'newModelEmployee', 
        'transferModelEmployee',
        'updateEmployeeSelect'
      ];
      
      selects.forEach(selectId => {
        const select = document.getElementById(selectId);
        if (select) {
          select.innerHTML = '<option value="">Select an employee</option>';
          
          if (allEmployees.length === 0) {
            select.innerHTML = '<option value="">No employees found</option>';
          } else {
            allEmployees.forEach(employee => {
              const option = document.createElement('option');
              option.value = JSON.stringify({
                id: employee.id,
                displayName: employee.displayName,
                mail: employee.mail || employee.userPrincipalName,
                jobTitle: employee.jobTitle || '',
                department: employee.department || '',
                mobilePhone: employee.mobilePhone || ''
              });
              option.textContent = `${employee.displayName} (${employee.mail || employee.userPrincipalName})`;
              select.appendChild(option);
            });
          }
        }
      });
    }

    // Load employee data for updating
    window.loadEmployeeData = function() {
      const employeeSelect = document.getElementById('updateEmployeeSelect');
      if (!employeeSelect.value) return;

      const employee = JSON.parse(employeeSelect.value);
      
      // Pre-populate form fields with current employee data
      document.getElementById('updateTitle').value = employee.jobTitle || '';
      document.getElementById('updateDepartment').value = employee.department || '';
      document.getElementById('updateMobilePhone').value = employee.mobilePhone || '';
      document.getElementById('updateEmail').value = employee.mail || '';
      document.getElementById('updateDisplayName').value = employee.displayName || '';
    };

    // Form Navigation Functions
    function handleVendorSelection() {
      const isVendor = document.getElementById('isVendor').value;
      const formTypeGroup = document.getElementById('formTypeGroup');
      const vendorRedirect = document.getElementById('vendor-redirect');
      
      if (isVendor === 'yes') {
        formTypeGroup.style.display = 'none';
        vendorRedirect.style.display = 'block';
        hideAllForms();
      } else if (isVendor === 'no') {
        formTypeGroup.style.display = 'block';
        vendorRedirect.style.display = 'none';
      } else {
        formTypeGroup.style.display = 'none';
        vendorRedirect.style.display = 'none';
      }
    }

    function showSelectedForm() {
      const formType = document.getElementById('formType').value;
      hideAllForms();
      
      switch(formType) {
        case 'new':
          document.getElementById('new-employee-form').style.display = 'block';
          break;
        case 'terminated':
          document.getElementById('terminated-employee-form').style.display = 'block';
          break;
        case 'transfer':
          document.getElementById('transfer-form').style.display = 'block';
          break;
      }
    }

    function hideAllForms() {
      const forms = ['new-employee-form', 'terminated-employee-form', 'transfer-form', 'vendor-redirect'];
      forms.forEach(formId => {
        const element = document.getElementById(formId);
        if (element) element.style.display = 'none';
      });
    }

    // Toggle Functions
    function toggleKineticFields(formType) {
      const kineticAccess = document.getElementById(formType + 'KineticAccess').value;
      const versionGroup = document.getElementById(formType + 'KineticVersionGroup');
      
      if (kineticAccess === 'yes' && versionGroup) {
        versionGroup.classList.remove('hidden-field');
      } else if (versionGroup) {
        versionGroup.classList.add('hidden-field');
      }
    }

    function toggleECxFields(formType) {
      const ecxAccess = document.getElementById(formType + 'ECxAccess').value;
      const permissionsGroup = document.getElementById(formType + 'ECxPermissionsGroup');
      
      if (ecxAccess === 'yes' && permissionsGroup) {
        permissionsGroup.classList.remove('hidden-field');
      } else if (permissionsGroup) {
        permissionsGroup.classList.add('hidden-field');
      }
    }

    function toggleEmailForwarding() {
      const hadEmail = document.getElementById('terminatedHadEmail').value;
      const emailGroup = document.getElementById('terminatedEmailForwardingGroup');
      const aliasGroup = document.getElementById('terminatedEmailAliasGroup');
      
      if (hadEmail === 'yes') {
        if (emailGroup) emailGroup.classList.remove('hidden-field');
        if (aliasGroup) aliasGroup.classList.remove('hidden-field');
      } else {
        if (emailGroup) emailGroup.classList.add('hidden-field');
        if (aliasGroup) aliasGroup.classList.add('hidden-field');
      }
    }

    function toggleDeviceReason() {
      const deviceCollected = document.getElementById('terminatedDeviceCollected').value;
      const reasonGroup = document.getElementById('terminatedDeviceReasonGroup');
      
      if (deviceCollected === 'no' && reasonGroup) {
        reasonGroup.classList.remove('hidden-field');
      } else if (reasonGroup) {
        reasonGroup.classList.add('hidden-field');
      }
    }

    // Reset Functions
    window.resetAllForms = function () {
      const forms = ['newEmployeeForm', 'terminatedEmployeeForm', 'transferForm', 'updateEmployeeForm'];
      forms.forEach(formId => {
        const form = document.getElementById(formId);
        if (form) form.reset();
      });
      
      document.getElementById('isVendor').value = '';
      document.getElementById('formType').value = '';
      document.getElementById('formTypeGroup').style.display = 'none';
      
      document.querySelectorAll('.hidden-field').forEach(field => {
        field.classList.add('hidden-field');
      });
      
      if (currentAccount) {
        loadAllEmployees();
      }
    };

    window.clearUpdateForm = function() {
      document.getElementById('updateEmployeeForm').reset();
      document.querySelectorAll('#update-employee-tab .hidden-field').forEach(field => {
        field.classList.add('hidden-field');
      });
    };

    window.submitAnother = function () {
      document.getElementById('confirmation-section').style.display = 'none';
      document.getElementById('form-type-section').style.display = 'block';
      resetAllForms();
    };

    window.goBack = function () {
      document.getElementById('vendor-redirect').style.display = 'none';
      document.getElementById('form-type-section').style.display = 'block';
      document.getElementById('isVendor').value = '';
      document.getElementById('formTypeGroup').style.display = 'none';
    };

    // Form Submission Event Listeners
    document.getElementById('terminatedEmployeeForm').addEventListener('submit', async function(event) {
      event.preventDefault();
      
      const submitButton = this.querySelector('button[type="submit"]');
      const originalText = submitButton.textContent;
      submitButton.disabled = true;
      submitButton.innerHTML = '<div class="spinner"></div>Submitting...';

      try {
        const employeeSelect = document.getElementById('terminatedEmployeeSelect');
        if (!employeeSelect.value) {
          throw new Error('Please select an employee to terminate.');
        }
        
        const selectedEmployee = JSON.parse(employeeSelect.value);
        const employeeEmail = selectedEmployee.mail;

        if (!employeeEmail) {
          throw new Error('The selected employee does not have a valid email address.');
        }

        const apiUrl = `https://ab251b24a8b8.ngrok-free.app/api/Employee/disable?email=${encodeURIComponent(employeeEmail)}`;

        const response = await fetch(apiUrl, {
          method: 'POST',
          headers: {
            'accept': '*/*',
          },
        });

        if (response.ok) {
          hideAllForms();
          document.getElementById('confirmation-section').style.display = 'block';
          document.getElementById('conf-form-type').textContent = 'Termination';
          document.getElementById('conf-manager').textContent = currentAccount.username;
          document.getElementById('conf-details').innerHTML = `<p><strong>Terminated Employee:</strong> ${selectedEmployee.displayName}</p>`;
        } else {
          const errorText = await response.text();
          throw new Error(`API Error: ${response.status} - ${errorText || 'Failed to submit termination.'}`);
        }

      } catch (error) {
        console.error('Termination submission failed:', error);
        document.getElementById('output').innerHTML = `<div class="error">Error: ${error.message}</div>`;
      } finally {
        submitButton.disabled = false;
        submitButton.textContent = originalText;
      }
    });

    document.getElementById('newEmployeeForm').addEventListener('submit', function(event) {
      event.preventDefault();
      
      hideAllForms();
      document.getElementById('confirmation-section').style.display = 'block';
      document.getElementById('conf-form-type').textContent = 'New Employee';
      document.getElementById('conf-manager').textContent = currentAccount.username;
      document.getElementById('conf-details').innerHTML = `
        <p><strong>New Employee:</strong> ${document.getElementById('newFirstName').value} ${document.getElementById('newLastName').value}</p>
        <p><strong>Department:</strong> ${document.getElementById('newDepartment').value}</p>
        <p><strong>Start Date:</strong> ${document.getElementById('newStartDate').value}</p>
      `;
    });

    document.getElementById('transferForm').addEventListener('submit', function(event) {
      event.preventDefault();
      
      const selectedEmployee = document.getElementById('transferEmployeeSelect').value ? 
        JSON.parse(document.getElementById('transferEmployeeSelect').value) : null;
      
      hideAllForms();
      document.getElementById('confirmation-section').style.display = 'block';
      document.getElementById('conf-form-type').textContent = 'Transfer';
      document.getElementById('conf-manager').textContent = currentAccount.username;
      document.getElementById('conf-details').innerHTML = `
        <p><strong>Transferred Employee:</strong> ${selectedEmployee ? selectedEmployee.displayName : 'Unknown'}</p>
        <p><strong>Transfer Date:</strong> ${document.getElementById('transferDate').value}</p>
        <p><strong>New Location:</strong> ${document.getElementById('transferWorkLocation').value}</p>
      `;
    });

    // Update Employee Form Submission
    document.getElementById('updateEmployeeForm').addEventListener('submit', async function(event) {
      event.preventDefault();
      
      const submitButton = this.querySelector('button[type="submit"]');
      const originalText = submitButton.textContent;
      submitButton.disabled = true;
      submitButton.innerHTML = '<div class="spinner"></div>Updating...';

      try {
        const employeeSelect = document.getElementById('updateEmployeeSelect');
        if (!employeeSelect.value) {
          throw new Error('Please select an employee to update.');
        }
        
        const selectedEmployee = JSON.parse(employeeSelect.value);
        
        hideAllForms();
        document.getElementById('confirmation-section').style.display = 'block';
        document.getElementById('conf-form-type').textContent = 'Employee Update';
        document.getElementById('conf-manager').textContent = currentAccount.username;
        document.getElementById('conf-details').innerHTML = `<p><strong>Updated Employee:</strong> ${selectedEmployee.displayName}</p>`;
        
        // Clear the form
        clearUpdateForm();

      } catch (error) {
        console.error('Update submission failed:', error);
        document.getElementById('output').innerHTML = `<div class="error">Error: ${error.message}</div>`;
      } finally {
        submitButton.disabled = false;
        submitButton.textContent = originalText;
      }
    });

    // Helper function to get selected checkbox values
    function getSelectedCheckboxValues(prefix) {
      const checkboxes = document.querySelectorAll(`#${prefix}ECxPermissionsGroup input[type="checkbox"]:checked`);
      return Array.from(checkboxes).map(cb => cb.value);
    }

    // Make functions available globally
    window.handleVendorSelection = handleVendorSelection;
    window.showSelectedForm = showSelectedForm;
    window.toggleKineticFields = toggleKineticFields;
    window.toggleECxFields = toggleECxFields;
    window.toggleEmailForwarding = toggleEmailForwarding;
    window.toggleDeviceReason = toggleDeviceReason;
  </script>
</body>
</html>
